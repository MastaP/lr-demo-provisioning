NameVirtualHost *

<VirtualHost *>
  ServerName java.answers.liverebel.com

  ProxyPreserveHost On
  ProxyPass /balancer-manager !

  <Location /balancer-manager>
    SetHandler balancer-manager
  </Location>

  <Proxy balancer://javacluster>
    <% route = 1 %>
    <% for item in @node["cluster"]["nodes"] %>
    BalancerMember http://<%= item %>:<%= node["cluster"]["javanodeport"] %> route=<%= route %>
    <%   route += 1 %>
    <% end %> 
  </Proxy>

  <Location />
    Allow from all
    ProxyPass balancer://javacluster/ stickysession=<%= node["cluster"]["javasessionid"] %> scolonpathdelim=On
  </Location>
</VirtualHost>

<VirtualHost *>
  ServerName php.answers.liverebel.com

  ProxyPreserveHost On
  ProxyPass /balancer-manager !

  <Location /balancer-manager>
    SetHandler balancer-manager
  </Location>

  <Proxy balancer://phpcluster>
    <% route = 1 %>
    <% for item in @node["cluster"]["nodes"] %>
    BalancerMember http://<%= item %>:<%= node["cluster"]["phpnodeport"] %> route=<%= route %>
    <%   route += 1 %>
    <% end %> 
  </Proxy>

  <Location />
    Allow from all
    ProxyPass balancer://phpcluster/ stickysession=<%= node["cluster"]["phpsessionid"] %>
  </Location>
</VirtualHost>
